<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Reddit Manager Pro</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');

:root {
  --bg-primary: #0d1117;
  --bg-secondary: #161b22;
  --bg-tertiary: #21262d;
  --accent: #ff6b6b;
  --accent-hover: #ff5252;
  --success: #51cf66;
  --warning: #ffd93d;
  --info: #4dabf7;
  --text: #f0f6fc;
  --text-muted: #8b949e;
  --border: #30363d;
  --shadow: rgba(0, 0, 0, 0.4);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, var(--bg-primary) 0%, #0a0e14 100%);
  color: var(--text);
  min-height: 100vh;
  padding: 16px 12px 120px;
  font-size: 14px;
  line-height: 1.5;
}

/* Animated Background */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 20% 50%, rgba(255, 107, 107, 0.05) 0%, transparent 50%),
    radial-gradient(circle at 80% 80%, rgba(81, 207, 102, 0.05) 0%, transparent 50%),
    radial-gradient(circle at 40% 20%, rgba(77, 171, 247, 0.05) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
  animation: pulse 15s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

/* Header */
.header {
  text-align: center;
  margin-bottom: 20px;
  position: relative;
  z-index: 1;
}

.header-title {
  font-size: 2rem;
  font-weight: 800;
  background: linear-gradient(135deg, var(--accent), var(--success), var(--info));
  background-size: 200% 200%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 4px;
  animation: gradient 8s ease infinite;
}

@keyframes gradient {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.header-subtitle {
  font-size: 0.85rem;
  color: var(--text-muted);
  font-weight: 600;
  letter-spacing: 0.5px;
}

.settings-icon {
  position: absolute;
  top: 0;
  right: 0;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  color: var(--text-muted);
  width: 36px;
  height: 36px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 1.2rem;
}

.settings-icon:hover {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
  transform: rotate(90deg);
}

/* Status Bar */
.status-bar {
  display: grid;
  grid-template-columns: 60px 1fr 1fr auto;
  gap: 8px;
  margin-bottom: 16px;
  position: relative;
  z-index: 1;
}

.status-ip {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px;
  text-align: center;
  font-weight: 700;
  font-size: 0.85rem;
  color: var(--text);
}

.status-counter {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px;
  text-align: center;
  font-weight: 700;
  font-size: 0.85rem;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.status-counter-label {
  font-size: 0.65rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-counter-value {
  font-size: 1.1rem;
}

.counter-active {
  border-color: var(--success);
  color: var(--success);
}

.counter-removed {
  border-color: var(--accent);
  color: var(--accent);
}

.status-toggle {
  background: var(--warning);
  color: #000;
  border: none;
  border-radius: 10px;
  padding: 10px 16px;
  font-weight: 700;
  font-size: 0.75rem;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-toggle:active {
  transform: scale(0.95);
}

.status-toggle.full {
  background: #000;
  color: var(--warning);
  border: 1px solid var(--warning);
}

/* Cards */
.card {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  transition: all 0.3s;
  position: relative;
  z-index: 1;
}

.card:hover {
  border-color: var(--accent);
  box-shadow: 0 4px 20px var(--shadow);
}

.card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  cursor: pointer;
  background: rgba(255, 255, 255, 0.02);
  border-bottom: 1px solid transparent;
  transition: all 0.2s;
}

.card-header:hover {
  background: rgba(255, 255, 255, 0.04);
}

.card.open .card-header {
  border-bottom-color: var(--border);
}

.card-title {
  font-weight: 700;
  font-size: 0.95rem;
  display: flex;
  align-items: center;
  gap: 8px;
}

.card-icon {
  font-size: 1.1rem;
}

.card-badge {
  background: var(--accent);
  color: white;
  padding: 3px 10px;
  border-radius: 12px;
  font-size: 0.7rem;
  font-weight: 700;
  margin-left: 8px;
  min-width: 40px;
  text-align: center;
}

.badge-success { background: var(--success); color: #000; }
.badge-info { background: var(--info); color: #000; }
.badge-warning { background: var(--warning); color: #000; }

.expand-icon {
  font-size: 1rem;
  transition: transform 0.3s;
  color: var(--text-muted);
}

.card.open .expand-icon {
  transform: rotate(180deg);
}

.card-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.card.open .card-body {
  max-height: 1200px;
  padding: 16px;
}

/* Form Elements */
.form-row {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
  margin-bottom: 10px;
}

.form-full { grid-column: 1 / -1; }

input, select, textarea {
  padding: 12px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text);
  font-size: 0.85rem;
  font-weight: 600;
  outline: none;
  width: 100%;
  transition: all 0.2s;
  font-family: inherit;
}

input:focus, select:focus, textarea:focus {
  border-color: var(--accent);
  background: var(--bg-primary);
  box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
}

input:read-only {
  opacity: 0.5;
  cursor: not-allowed;
}

textarea {
  font-family: 'Courier New', monospace;
  resize: vertical;
  min-height: 100px;
}

/* Buttons */
.btn {
  padding: 11px 18px;
  border: none;
  border-radius: 10px;
  font-weight: 700;
  font-size: 0.8rem;
  cursor: pointer;
  transition: all 0.2s;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-family: inherit;
}

.btn:active {
  transform: scale(0.96);
}

.btn-primary {
  background: var(--accent);
  color: white;
}

.btn-primary:hover {
  background: var(--accent-hover);
  box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
}

.btn-success {
  background: var(--success);
  color: #000;
}

.btn-success:hover {
  box-shadow: 0 4px 12px rgba(81, 207, 102, 0.3);
}

.btn-secondary {
  background: var(--bg-tertiary);
  color: var(--text);
  border: 1px solid var(--border);
}

.btn-secondary:hover {
  background: var(--bg-primary);
  border-color: var(--accent);
}

.btn-small {
  padding: 8px 14px;
  font-size: 0.7rem;
}

.btn-group {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.btn-full { width: 100%; }

/* Account Status Colors */
.btn-active {
  background: var(--success);
  color: #000;
}

.btn-banned {
  background: var(--accent);
  color: white;
}

.btn-checking {
  background: var(--warning);
  color: #000;
}

/* Stats */
.stat-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  color: var(--text-muted);
  font-size: 0.85rem;
}

.stat-value {
  font-weight: 700;
  color: var(--text);
}

/* Lists */
.list {
  max-height: 280px;
  overflow-y: auto;
  background: var(--bg-primary);
  border-radius: 10px;
  padding: 8px;
  margin-top: 12px;
}

.list-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: 8px;
  margin-bottom: 6px;
  font-size: 0.85rem;
  transition: all 0.2s;
}

.list-item:hover {
  border-color: var(--accent);
  background: var(--bg-secondary);
}

.list-item.checked {
  opacity: 0.4;
  text-decoration: line-through;
}

.list-item input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: var(--accent);
}

.list-item-text {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.list-item-delete {
  background: none;
  border: none;
  color: var(--accent);
  font-size: 1.3rem;
  cursor: pointer;
  padding: 0 6px;
  transition: all 0.2s;
}

.list-item-delete:hover {
  color: var(--accent-hover);
  transform: scale(1.2);
}

/* Status Display */
.status-display {
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 14px;
  margin: 10px 0;
  text-align: center;
}

.status-label {
  font-size: 0.7rem;
  color: var(--text-muted);
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 700;
}

.status-value {
  font-size: 1.2rem;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 4px;
}

.status-sub {
  font-size: 0.75rem;
  color: var(--text-muted);
}

/* Floating Actions */
.fab-bar {
  position: fixed;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 10px;
  background: rgba(22, 27, 34, 0.95);
  backdrop-filter: blur(20px);
  padding: 12px 16px;
  border-radius: 50px;
  border: 1px solid var(--border);
  box-shadow: 0 10px 40px var(--shadow);
  z-index: 1000;
  max-width: 95vw;
  overflow-x: auto;
}

.fab {
  width: 52px;
  height: 52px;
  min-width: 52px;
  border-radius: 50%;
  background: var(--accent);
  color: white;
  border: none;
  font-weight: 700;
  font-size: 0.9rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
}

.fab:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 20px rgba(255, 107, 107, 0.5);
}

.fab:active {
  transform: scale(0.95);
}

/* Toast */
.toast {
  position: fixed;
  bottom: 90px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--accent);
  color: white;
  padding: 12px 24px;
  border-radius: 25px;
  font-weight: 700;
  font-size: 0.85rem;
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  pointer-events: none;
  z-index: 9001;
  max-width: 90vw;
  text-align: center;
  box-shadow: 0 8px 24px var(--shadow);
}

.toast.show {
  opacity: 1;
  bottom: 100px;
}

/* Settings Modal */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(5px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  padding: 20px;
  animation: fadeIn 0.3s;
}

.modal-overlay.show {
  display: flex;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.modal {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 16px;
  max-width: 500px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 20px 60px var(--shadow);
}

@keyframes slideUp {
  from {
    transform: translateY(50px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
  border-bottom: 1px solid var(--border);
}

.modal-title {
  font-size: 1.3rem;
  font-weight: 800;
  color: var(--text);
}

.modal-close {
  background: none;
  border: none;
  color: var(--text-muted);
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  transition: all 0.2s;
}

.modal-close:hover {
  background: var(--accent);
  color: white;
}

.modal-body {
  padding: 20px;
}

.setting-group {
  margin-bottom: 20px;
}

.setting-label {
  font-size: 0.85rem;
  font-weight: 700;
  color: var(--text);
  margin-bottom: 8px;
  display: block;
}

.setting-desc {
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-top: 4px;
}

.connection-status {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 700;
  margin-top: 8px;
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--text-muted);
  animation: pulse-dot 2s infinite;
}

@keyframes pulse-dot {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.status-dot.connected {
  background: var(--success);
}

.status-dot.disconnected {
  background: var(--accent);
}

/* Scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--bg-primary);
}

::-webkit-scrollbar-thumb {
  background: var(--accent);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--accent-hover);
}

/* Loading Animation */
.loading {
  display: inline-block;
  width: 16px;
  height: 16px;
  border: 2px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 380px) {
  .header-title { font-size: 1.6rem; }
  .fab { width: 48px; height: 48px; min-width: 48px; font-size: 0.8rem; }
  .status-bar { grid-template-columns: 50px 1fr 1fr auto; }
  .status-ip { padding: 8px; font-size: 0.75rem; }
}
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="settings-icon" onclick="openSettings()">‚öôÔ∏è</div>
  <h1 class="header-title">Reddit Manager Pro</h1>
  <div class="header-subtitle">Streamlined automation toolkit</div>
</div>

<!-- Status Bar -->
<div class="status-bar">
  <input type="text" class="status-ip" id="ipInput" placeholder="IP" value="1" maxlength="16">
  <div class="status-counter counter-active">
    <div class="status-counter-label">Active P&C</div>
    <div class="status-counter-value" id="activeCount">0</div>
  </div>
  <div class="status-counter counter-removed">
    <div class="status-counter-label">Removed</div>
    <div class="status-counter-value" id="removedCount">0</div>
  </div>
  <button class="status-toggle" id="ipToggle">Local</button>
</div>

<!-- Account Card -->
<div class="card">
  <div class="card-header" onclick="toggleCard(this)">
    <div class="card-title">
      <span class="card-icon">üë§</span>
      Account
      <span class="card-badge" id="accountBadge">0/0</span>
    </div>
    <span class="expand-icon">‚ñº</span>
  </div>
  <div class="card-body">
    <div class="form-row">
      <input type="text" id="accEmail" placeholder="üìß Email" readonly>
      <input type="text" id="accUser" placeholder="üë§ Username">
      <input type="text" id="accPass" placeholder="üîë Password">
      <input type="text" id="accId" placeholder="üÜî ID" readonly>
    </div>
    <div class="btn-group">
      <button class="btn btn-secondary btn-small" onclick="copy('accEmail')">üìß</button>
      <button class="btn btn-secondary btn-small" onclick="copy('accUser')">üë§</button>
      <button class="btn btn-secondary btn-small" onclick="copy('accPass')">üîë</button>
      <button class="btn btn-secondary btn-small" onclick="copy('accId')">üÜî</button>
    </div>
    <div class="btn-group" style="margin-top: 10px;">
      <button class="btn btn-secondary" onclick="prevAccount()">‚óÄ</button>
      <button class="btn btn-secondary" onclick="generatePass()">üé≤ Gen</button>
      <button class="btn btn-secondary" onclick="pasteUser()">üìã Paste</button>
      <button class="btn btn-secondary" onclick="nextAccount()">‚ñ∂</button>
    </div>
    <button class="btn btn-primary btn-full" id="saveAccBtn" onclick="saveAccount()" style="margin-top: 10px;">üíæ Save Account</button>
  </div>
</div>

<!-- Location Card -->
<div class="card">
  <div class="card-header" onclick="toggleCard(this)">
    <div class="card-title">
      <span class="card-icon">üìç</span>
      Location
      <span class="card-badge badge-info" id="locBadge">0/0</span>
    </div>
    <span class="expand-icon">‚ñº</span>
  </div>
  <div class="card-body">
    <select id="locationSelect" class="form-full" style="margin-bottom: 12px;"></select>
    <div class="stat-row">
      <span>Progress: <span class="stat-value" id="locProgress">0/0</span></span>
      <div class="btn-group">
        <button class="btn btn-secondary btn-small" onclick="resetLocation()">üîÑ</button>
        <button class="btn btn-secondary btn-small" onclick="addSubs()">‚ûï</button>
      </div>
    </div>
    <div class="btn-group">
      <button class="btn btn-secondary btn-small" style="flex:1;" onclick="refreshData()">üîÑ Refresh</button>
      <button class="btn btn-secondary btn-small" style="flex:1;" onclick="toggleList('locList')">üìã List</button>
    </div>
    <div class="list" id="locList" style="display:none;"></div>
  </div>
</div>

<!-- Test Subs Card -->
<div class="card">
  <div class="card-header" onclick="toggleCard(this)">
    <div class="card-title">
      <span class="card-icon">üß™</span>
      Test Subs
      <span class="card-badge badge-warning" id="testBadge">0/0</span>
    </div>
    <span class="expand-icon">‚ñº</span>
  </div>
  <div class="card-body">
    <div class="stat-row">
      <span>Progress: <span class="stat-value" id="testProgress">0/0</span></span>
      <div class="btn-group">
        <button class="btn btn-secondary btn-small" onclick="resetTest()">üîÑ</button>
        <button class="btn btn-secondary btn-small" onclick="addTestSubs()">‚ûï</button>
      </div>
    </div>
    <div class="btn-group">
      <button class="btn btn-secondary btn-small" style="flex:1;" onclick="refreshData()">üîÑ Refresh</button>
      <button class="btn btn-secondary btn-small" style="flex:1;" onclick="toggleList('testList')">üìã List</button>
    </div>
    <div class="list" id="testList" style="display:none;"></div>
  </div>
</div>

<!-- Captions Card -->
<div class="card">
  <div class="card-header" onclick="toggleCard(this)">
    <div class="card-title">
      <span class="card-icon">üí¨</span>
      Captions
      <span class="card-badge badge-success" id="capBadge">0/0</span>
    </div>
    <span class="expand-icon">‚ñº</span>
  </div>
  <div class="card-body">
    <div class="stat-row">
      <span>Used: <span class="stat-value" id="capProgress">0/0</span></span>
      <div class="btn-group">
        <button class="btn btn-secondary btn-small" onclick="resetCaptions()">üîÑ</button>
        <button class="btn btn-secondary btn-small" onclick="addCaptions()">‚ûï</button>
      </div>
    </div>
    <div class="btn-group">
      <button class="btn btn-secondary btn-small" style="flex:1;" onclick="refreshData()">üîÑ Refresh</button>
      <button class="btn btn-secondary btn-small" style="flex:1;" onclick="toggleList('capList')">üìã List</button>
    </div>
    <div class="list" id="capList" style="display:none;"></div>
  </div>
</div>

<!-- Network Card -->
<div class="card">
  <div class="card-header" onclick="toggleCard(this)">
    <div class="card-title">
      <span class="card-icon">üåê</span>
      <span id="headerIp">Loading...</span>
      <button class="btn btn-success btn-full" onclick="checkIp()">üîç Check IP + Scam</button>
    </div>
    <span class="expand-icon">‚ñº</span>
  </div>
  <div class="card-body">
    <div class="btn-group" style="margin-bottom: 12px;">
      <button class="btn btn-primary btn-small" onclick="rotateIp()">üîÑ Rotate</button>
      <input type="text" id="rotateUrl" placeholder="Rotation URL" style="flex:1;">
    </div>
    <div class="status-display">
      <div class="status-label">Previous IP</div>
      <div class="status-value" id="oldIp">‚Äî</div>
    </div>
    <div class="status-display">
      <div class="status-label">Current IP</div>
      <div class="status-value" id="currentIp">Loading...</div>
      <div class="status-sub" id="ipLocation">‚Äî</div>
    </div>
    
  </div>
</div>

<!-- Floating Actions -->
<div class="fab-bar">
  <button class="fab" onclick="copyDm()" title="DM">üíå</button>
  <button class="fab" onclick="copyName()" title="Name">üìõ</button>
  <button class="fab" onclick="copyOf()" title="OF">üîû</button>
  <button class="fab" onclick="copyLink()" title="Link">üîó</button>
  <button class="fab" onclick="postMain()" title="Main Post">üìç</button>
  <button class="fab" onclick="postTest()" title="Test Post">üß™</button>
  <button class="fab" onclick="randomSub()" title="Random">üé≤</button>
  <button class="fab" onclick="createAccount()" title="Create">‚ûï</button>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Settings Modal -->
<div class="modal-overlay" id="settingsModal">
  <div class="modal">
    <div class="modal-header">
      <h2 class="modal-title">‚öôÔ∏è Settings</h2>
      <button class="modal-close" onclick="closeSettings()">√ó</button>
    </div>
    <div class="modal-body">
      <div class="setting-group">
        <label class="setting-label">API Endpoint</label>
        <input type="url" id="apiUrl" class="form-full" placeholder="https://script.google.com/macros/s/...">
        <div class="setting-desc">Your Google Apps Script web app URL</div>
        <div class="connection-status">
          <span class="status-dot" id="apiStatusDot"></span>
          <span id="apiStatusText">Not configured</span>
        </div>
      </div>
      
      <div class="setting-group">
        <label class="setting-label">Rotation URL</label>
        <input type="url" id="rotateUrlSetting" class="form-full" placeholder="http://87.120...">
        <div class="setting-desc">IP rotation endpoint (optional)</div>
      </div>
      
      <div class="setting-group">
        <label class="setting-label">CatScript Script Name</label>
        <input type="text" id="scriptNameSetting" class="form-full" placeholder="openReddit.py" value="openReddit.py">
        <div class="setting-desc">Python script to run on CatScript (port 5000)</div>
      </div>
      
      <div class="btn-group">
        <button class="btn btn-success" style="flex:1;" onclick="saveSettings()">üíæ Save Settings</button>
        <button class="btn btn-secondary" onclick="testApi()">üîç Test API</button>
      </div>
      
      <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
        <button class="btn btn-secondary btn-full" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
      </div>
    </div>
  </div>
</div>

<script>
// ==================== CONFIGURATION ====================
const CONFIG = {
  apiUrl: localStorage.getItem('apiUrl') || '',
  ipMode: localStorage.getItem('ipMode') || 'local',
  rotateUrl: localStorage.getItem('rotateUrl') || '',
  scriptName: localStorage.getItem('scriptName') || 'openReddit.py',
};

// ==================== STATE ====================
const STATE = {
  accounts: [],
  currentAccountIndex: parseInt(localStorage.getItem('accountIndex') || '0'),
  locations: {},
  currentLocation: localStorage.getItem('currentLocation') || '',
  locationSubs: [],
  locationChecked: {},
  locationIndex: 0,
  testSubs: [],
  testChecked: {},
  testIndex: 0,
  captions: [],
  captionUsed: {},
  randomSubs: [],
  dmTexts: [],
  names: [],
  ofLines: [],
  linkUrl: '',
  currentIp: '',
  previousIp: '',
  dmUsed: {},
  nameUsed: {},
  ofUsed: {},
};

// ==================== DEFAULTS ====================
const DEFAULTS = {
  dms: [
    "I'm new here, come take a peek at my page below and enjoy a little surprise I left for you",
    "Still figuring things out here, check out my page and grab your free surprise",
    "Just getting started here, have a look at my page and claim your cute freebie"
  ],
  names: [
    "Sophyy üå∏", "Sophiaa üå∑", "Sophi üíã", "Sophiya üå∫", "Sofayuh üòç"
  ],
  of: [
    "OF (nudes&dms)üòú", "OF (nudez&seks)üòú", "OF (nudes&dms)üôà"
  ],
  link: "https://tapformysocials.me/girlygirl"
};

// ==================== INITIALIZATION ====================
function init() {
  loadState();
  updateIpToggle();
  loadApiSettings();
  fetchCurrentIp();
  
  if (CONFIG.apiUrl) {
    refreshData();
    loadAccounts();
  } else {
    toast('‚öôÔ∏è Configure API in settings');
  }
  
  updateAllStats();
  startAccountChecker();
}

function loadState() {
  STATE.locationChecked = JSON.parse(localStorage.getItem('locationChecked') || '{}');
  STATE.locationIndex = parseInt(localStorage.getItem('locationIndex') || '0');
  STATE.testChecked = JSON.parse(localStorage.getItem('testChecked') || '{}');
  STATE.testIndex = parseInt(localStorage.getItem('testIndex') || '0');
  STATE.captionUsed = JSON.parse(localStorage.getItem('captionUsed') || '{}');
  STATE.dmUsed = JSON.parse(localStorage.getItem('dmUsed') || '{}');
  STATE.nameUsed = JSON.parse(localStorage.getItem('nameUsed') || '{}');
  STATE.ofUsed = JSON.parse(localStorage.getItem('ofUsed') || '{}');
  
  if (STATE.currentLocation) {
    loadLocationData(STATE.currentLocation);
  }
}

function saveState() {
  localStorage.setItem('accountIndex', STATE.currentAccountIndex);
  localStorage.setItem('currentLocation', STATE.currentLocation);
  localStorage.setItem('locationChecked', JSON.stringify(STATE.locationChecked));
  localStorage.setItem('locationIndex', STATE.locationIndex);
  localStorage.setItem('testChecked', JSON.stringify(STATE.testChecked));
  localStorage.setItem('testIndex', STATE.testIndex);
  localStorage.setItem('captionUsed', JSON.stringify(STATE.captionUsed));
  localStorage.setItem('dmUsed', JSON.stringify(STATE.dmUsed));
  localStorage.setItem('nameUsed', JSON.stringify(STATE.nameUsed));
  localStorage.setItem('ofUsed', JSON.stringify(STATE.ofUsed));
}

// ==================== SETTINGS ====================
function openSettings() {
  document.getElementById('settingsModal').classList.add('show');
}

function closeSettings() {
  document.getElementById('settingsModal').classList.remove('show');
}

function loadApiSettings() {
  document.getElementById('apiUrl').value = CONFIG.apiUrl;
  document.getElementById('rotateUrlSetting').value = CONFIG.rotateUrl;
  document.getElementById('rotateUrl').value = CONFIG.rotateUrl;
  document.getElementById('scriptNameSetting').value = CONFIG.scriptName;
  updateApiStatus();
}

function saveSettings() {
  CONFIG.apiUrl = document.getElementById('apiUrl').value.trim();
  CONFIG.rotateUrl = document.getElementById('rotateUrlSetting').value.trim();
  CONFIG.scriptName = document.getElementById('scriptNameSetting').value.trim() || 'openReddit.py';
  
  localStorage.setItem('apiUrl', CONFIG.apiUrl);
  localStorage.setItem('rotateUrl', CONFIG.rotateUrl);
  localStorage.setItem('scriptName', CONFIG.scriptName);
  
  document.getElementById('rotateUrl').value = CONFIG.rotateUrl;
  
  updateApiStatus();
  toast('‚úÖ Settings saved');
  
  if (CONFIG.apiUrl) {
    refreshData();
    loadAccounts();
  }
}

async function testApi() {
  if (!CONFIG.apiUrl) {
    toast('‚ö†Ô∏è Enter API URL first');
    return;
  }
  
  toast('üîç Testing connection...');
  
  try {
    const response = await fetch(`${CONFIG.apiUrl}?action=readAll&t=${Date.now()}`);
    const data = await response.json();
    
    if (data.error) {
      toast('‚ùå API Error: ' + data.error);
      updateApiStatus(false);
    } else if (data.sheet1 || data.sheet2) {
      toast('‚úÖ API connection successful!');
      updateApiStatus(true);
    } else {
      toast('‚ö†Ô∏è Unexpected response');
      updateApiStatus(false);
    }
  } catch (error) {
    toast('‚ùå Connection failed: ' + error.message);
    updateApiStatus(false);
  }
}

function updateApiStatus(isConnected = null) {
  const dot = document.getElementById('apiStatusDot');
  const text = document.getElementById('apiStatusText');
  
  if (!CONFIG.apiUrl) {
    dot.className = 'status-dot';
    text.textContent = 'Not configured';
    return;
  }
  
  if (isConnected === null) {
    dot.className = 'status-dot';
    text.textContent = 'Configured';
  } else if (isConnected) {
    dot.className = 'status-dot connected';
    text.textContent = 'Connected';
  } else {
    dot.className = 'status-dot disconnected';
    text.textContent = 'Connection failed';
  }
}

function clearAllData() {
  if (!confirm('‚ö†Ô∏è Clear ALL local data? This cannot be undone!')) return;
  
  localStorage.clear();
  location.reload();
}

// ==================== API FUNCTIONS ====================
async function refreshData() {
  if (!CONFIG.apiUrl) {
    toast('‚ö†Ô∏è Configure API first');
    return;
  }
  
  toast('üîÑ Loading data...');
  
  try {
    const response = await fetch(`${CONFIG.apiUrl}?action=readAll&t=${Date.now()}`);
    const data = await response.json();
    
    if (data.error) {
      throw new Error(data.error);
    }
    
    // Sheet1: Data
    const sheet1 = data.sheet1 || [];
    STATE.captions = sheet1.slice(1).map(row => row[0]).filter(Boolean);
    STATE.randomSubs = sheet1.slice(1).map(row => row[1]).filter(Boolean);
    STATE.testSubs = sheet1.slice(1).map(row => row[2]).filter(Boolean);
    STATE.dmTexts = sheet1.slice(1).map(row => row[3]).filter(Boolean);
    STATE.names = sheet1.slice(1).map(row => row[4]).filter(Boolean);
    STATE.ofLines = sheet1.slice(1).map(row => row[5]).filter(Boolean);
    
    if (sheet1[1] && sheet1[1][6]) {
      STATE.linkUrl = sheet1[1][6];
    }
    
    // Use defaults if empty
    if (STATE.dmTexts.length === 0) STATE.dmTexts = DEFAULTS.dms;
    if (STATE.names.length === 0) STATE.names = DEFAULTS.names;
    if (STATE.ofLines.length === 0) STATE.ofLines = DEFAULTS.of;
    if (!STATE.linkUrl) STATE.linkUrl = DEFAULTS.link;
    
    // Sheet2: Locations
    const sheet2 = data.sheet2 || [];
    if (sheet2.length > 0) {
      const headers = sheet2[0];
      STATE.locations = {};
      
      headers.forEach((location, colIdx) => {
        if (location && location.trim()) {
          const subs = [];
          for (let i = 1; i < sheet2.length; i++) {
            const sub = sheet2[i][colIdx];
            if (sub && sub.trim()) {
              subs.push(sub.trim());
            }
          }
          if (subs.length > 0) {
            STATE.locations[location.trim()] = subs;
          }
        }
      });
    }
    
    populateLocationSelect();
    
    if (!STATE.currentLocation || !STATE.locations[STATE.currentLocation]) {
      const firstLocation = Object.keys(STATE.locations)[0];
      if (firstLocation) {
        selectLocation(firstLocation);
      }
    } else {
      selectLocation(STATE.currentLocation);
    }
    
    renderList('testList', STATE.testSubs, STATE.testChecked);
    renderList('capList', STATE.captions, STATE.captionUsed);
    updateAllStats();
    updateApiStatus(true);
    toast('‚úÖ Data loaded');
    
  } catch (error) {
    console.error('Refresh error:', error);
    updateApiStatus(false);
    toast('‚ùå Load failed: ' + error.message);
  }
}

// ==================== ACCOUNT FUNCTIONS ====================
async function loadAccounts() {
  if (!CONFIG.apiUrl) return;
  
  try {
    const response = await fetch(`${CONFIG.apiUrl}?action=read&t=${Date.now()}`);
    const data = await response.json();
    
    if (data.error) {
      throw new Error(data.error);
    }
    
    STATE.accounts = data.values || [];
    
    if (STATE.accounts.length > 0) {
      if (STATE.currentAccountIndex >= STATE.accounts.length) {
        STATE.currentAccountIndex = STATE.accounts.length - 1;
      }
      loadAccount(STATE.currentAccountIndex);
    } else {
      clearAccountFields();
    }
    
    updateAccountBadge();
  } catch (error) {
    console.error('Load accounts error:', error);
    toast('‚ö†Ô∏è Failed to load accounts');
  }
}

function loadAccount(index) {
  if (STATE.accounts.length === 0) return;
  
  index = Math.max(0, Math.min(index, STATE.accounts.length - 1));
  const account = STATE.accounts[index];
  
  document.getElementById('accEmail').value = account[0] || '';
  document.getElementById('accPass').value = account[1] || '';
  document.getElementById('accUser').value = account[2] || '';
  document.getElementById('accId').value = account[3] || '';
  
  STATE.currentAccountIndex = index;
  saveState();
  updateAccountBadge();
}

function clearAccountFields() {
  document.getElementById('accEmail').value = '';
  document.getElementById('accPass').value = '';
  document.getElementById('accUser').value = '';
  document.getElementById('accId').value = '';
}

function prevAccount() {
  if (STATE.accounts.length === 0) return;
  loadAccount(STATE.currentAccountIndex - 1);
}

function nextAccount() {
  if (STATE.accounts.length === 0) return;
  loadAccount(STATE.currentAccountIndex + 1);
}

function generatePass() {
  const words = ["cat", "dog", "sun", "sky", "sea", "pen", "cup", "hat", "map", "run",
    "walk", "talk", "play", "read", "book", "tree", "rock", "sand", "wind", "rain"];
  
  const numWords = Math.floor(Math.random() * 3) + 3;
  const selectedWords = [];
  
  for (let i = 0; i < numWords; i++) {
    selectedWords.push(words[Math.floor(Math.random() * words.length)]);
  }
  
  const password = "reddit" + selectedWords.join("");
  document.getElementById('accPass').value = password;
  copy('accPass');
  triggerCatsript();
  toast('üîë Password generated');
}

async function pasteUser() {
  try {
    const text = await navigator.clipboard.readText();
    document.getElementById('accUser').value = text.trim();
    toast('üìã Username pasted');
  } catch {
    toast('‚ö†Ô∏è Paste failed');
  }
}

async function saveAccount() {
  const pass = document.getElementById('accPass').value.trim();
  const user = document.getElementById('accUser').value.trim();
  
  if (!pass || !user) {
    toast('‚ö†Ô∏è Fill password & username');
    return;
  }
  
  if (!CONFIG.apiUrl) {
    toast('‚ö†Ô∏è Configure API first');
    return;
  }
  
  const row = STATE.currentAccountIndex + 2;
  
  try {
    const url = `${CONFIG.apiUrl}?action=write&row=${row}&pass=${encodeURIComponent(pass)}&user=${encodeURIComponent(user)}&t=${Date.now()}`;
    const response = await fetch(url);
    const data = await response.json();
    
    if (data.error) {
      throw new Error(data.error);
    }
    
    if (STATE.accounts[STATE.currentAccountIndex]) {
      STATE.accounts[STATE.currentAccountIndex][1] = pass;
      STATE.accounts[STATE.currentAccountIndex][2] = user;
    }
    
    toast('‚úÖ Account saved');
  } catch (error) {
    toast('‚ùå Save failed: ' + error.message);
  }
}

function updateAccountBadge() {
  const total = STATE.accounts.length;
  const current = total > 0 ? STATE.currentAccountIndex + 1 : 0;
  document.getElementById('accountBadge').textContent = `${current}/${total}`;
}

// Account checker
let accountCheckInterval = null;

async function checkRedditAccount(username) {
  if (!username || !username.trim()) return { status: 'empty', posts: 0, removed: 0 };
  
  try {
    const response = await fetch(`https://www.reddit.com/user/${username.trim()}.json?limit=100`);
    
    if (!response.ok) {
      if (response.status === 404) return { status: 'notfound', posts: 0, removed: 0 };
      return { status: 'error', posts: 0, removed: 0 };
    }
    
    const data = await response.json();
    
    if (data && data.data && data.data.children) {
      let activePosts = 0;
      let removedPosts = 0;
      
      data.data.children.forEach(post => {
        const postData = post.data;
        
        if (postData.removed_by_category || postData.spam || postData.banned_by || 
            postData.removed || postData.author === '[deleted]' || postData.selftext === '[removed]') {
          removedPosts++;
        } else {
          activePosts++;
        }
      });
      
      return { status: 'active', posts: activePosts, removed: removedPosts };
    }
    
    const aboutResponse = await fetch(`https://www.reddit.com/user/${username.trim()}/about.json`);
    const aboutData = await aboutResponse.json();
    
    if (aboutData && aboutData.data && aboutData.data.is_suspended) {
      return { status: 'banned', posts: 0, removed: 0 };
    }
    
    return { status: 'active', posts: 0, removed: 0 };
    
  } catch (error) {
    return { status: 'error', posts: 0, removed: 0 };
  }
}

async function updateAccountStatus() {
  const username = document.getElementById('accUser').value.trim();
  const saveBtn = document.getElementById('saveAccBtn');
  
  if (!username) {
    saveBtn.className = 'btn btn-primary btn-full';
    document.getElementById('activeCount').textContent = '0';
    document.getElementById('removedCount').textContent = '0';
    return;
  }
  
  const result = await checkRedditAccount(username);
  
  switch(result.status) {
    case 'active':
      saveBtn.className = 'btn btn-primary btn-full btn-active';
      break;
    case 'banned':
      saveBtn.className = 'btn btn-primary btn-full btn-banned';
      break;
    case 'notfound':
      saveBtn.className = 'btn btn-primary btn-full';
      break;
    default:
      saveBtn.className = 'btn btn-primary btn-full btn-checking';
  }
  
  document.getElementById('activeCount').textContent = result.posts.toString();
  document.getElementById('removedCount').textContent = result.removed.toString();
}

function startAccountChecker() {
  if (accountCheckInterval) clearInterval(accountCheckInterval);
  
  updateAccountStatus();
  accountCheckInterval = setInterval(updateAccountStatus, 5000);
}

function stopAccountChecker() {
  if (accountCheckInterval) {
    clearInterval(accountCheckInterval);
    accountCheckInterval = null;
  }
}

// ==================== LOCATION FUNCTIONS ====================
function populateLocationSelect() {
  const select = document.getElementById('locationSelect');
  select.innerHTML = '<option value="">-- Select Location --</option>';
  
  Object.keys(STATE.locations).sort().forEach(location => {
    const option = document.createElement('option');
    option.value = location;
    option.textContent = location;
    select.appendChild(option);
  });
  
  select.onchange = () => selectLocation(select.value);
}

function selectLocation(location) {
  if (!location || !STATE.locations[location]) {
    STATE.locationSubs = [];
    STATE.currentLocation = '';
  } else {
    STATE.currentLocation = location;
    STATE.locationSubs = STATE.locations[location];
    loadLocationData(location);
  }
  
  saveState();
  document.getElementById('locationSelect').value = STATE.currentLocation;
  renderList('locList', STATE.locationSubs, STATE.locationChecked);
  updateAllStats();
}

function loadLocationData(location) {
  const key = 'loc_' + btoa(location).replace(/=/g, '');
  STATE.locationChecked = JSON.parse(localStorage.getItem(key + '_checked') || '{}');
  STATE.locationIndex = parseInt(localStorage.getItem(key + '_index') || '0');
}

function saveLocationData() {
  if (!STATE.currentLocation) return;
  const key = 'loc_' + btoa(STATE.currentLocation).replace(/=/g, '');
  localStorage.setItem(key + '_checked', JSON.stringify(STATE.locationChecked));
  localStorage.setItem(key + '_index', STATE.locationIndex);
}

function resetLocation() {
  if (!confirm('Reset location progress?')) return;
  STATE.locationChecked = {};
  STATE.locationIndex = 0;
  saveLocationData();
  saveState();
  renderList('locList', STATE.locationSubs, STATE.locationChecked);
  updateAllStats();
  toast('üîÑ Location reset');
}

function addSubs() {
  if (!STATE.currentLocation) {
    toast('‚ö†Ô∏è Select location first');
    return;
  }
  
  const input = prompt('Add subreddits (one per line, no r/):');
  if (!input) return;
  
  const newSubs = input.split('\n').map(s => s.trim()).filter(s => s && !STATE.locationSubs.includes(s));
  
  if (newSubs.length > 0) {
    STATE.locationSubs.push(...newSubs);
    STATE.locations[STATE.currentLocation] = STATE.locationSubs;
    renderList('locList', STATE.locationSubs, STATE.locationChecked);
    updateAllStats();
    toast(`‚úÖ Added ${newSubs.length} subs`);
  }
}

// ==================== TEST SUBS ====================
function resetTest() {
  if (!confirm('Reset test subs?')) return;
  STATE.testChecked = {};
  STATE.testIndex = 0;
  saveState();
  renderList('testList', STATE.testSubs, STATE.testChecked);
  updateAllStats();
  toast('üîÑ Test reset');
}

function addTestSubs() {
  const input = prompt('Add test subs (one per line, no r/):');
  if (!input) return;
  
  const newSubs = input.split('\n').map(s => s.trim()).filter(s => s && !STATE.testSubs.includes(s));
  
  if (newSubs.length > 0) {
    STATE.testSubs.push(...newSubs);
    renderList('testList', STATE.testSubs, STATE.testChecked);
    updateAllStats();
    toast(`‚úÖ Added ${newSubs.length} test subs`);
  }
}

// ==================== CAPTIONS ====================
function resetCaptions() {
  if (!confirm('Reset captions?')) return;
  STATE.captionUsed = {};
  saveState();
  renderList('capList', STATE.captions, STATE.captionUsed);
  updateAllStats();
  toast('üîÑ Captions reset');
}

function addCaptions() {
  const input = prompt('Add captions (one per line):');
  if (!input) return;
  
  const newCaptions = input.split('\n').map(c => c.trim()).filter(c => c && !STATE.captions.includes(c));
  
  if (newCaptions.length > 0) {
    STATE.captions.push(...newCaptions);
    renderList('capList', STATE.captions, STATE.captionUsed);
    updateAllStats();
    toast(`‚úÖ Added ${newCaptions.length} captions`);
  }
}

// ==================== RENDERING ====================
function renderList(listId, items, checkedState) {
  const list = document.getElementById(listId);
  list.innerHTML = '';
  
  items.forEach((item, index) => {
    const div = document.createElement('div');
    div.className = 'list-item' + (checkedState[item] ? ' checked' : '');
    
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.checked = !!checkedState[item];
    checkbox.onchange = () => {
      checkedState[item] = !checkedState[item];
      saveState();
      saveLocationData();
      renderList(listId, items, checkedState);
      updateAllStats();
    };
    
    const text = document.createElement('div');
    text.className = 'list-item-text';
    text.textContent = item;
    
    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'list-item-delete';
    deleteBtn.textContent = '√ó';
    deleteBtn.onclick = () => {
      if (!confirm('Delete?')) return;
      items.splice(index, 1);
      delete checkedState[item];
      saveState();
      saveLocationData();
      renderList(listId, items, checkedState);
      updateAllStats();
      toast('üóëÔ∏è Deleted');
    };
    
    div.appendChild(checkbox);
    div.appendChild(text);
    div.appendChild(deleteBtn);
    list.appendChild(div);
  });
}

function updateAllStats() {
  const locChecked = Object.values(STATE.locationChecked).filter(v => v).length;
  const locTotal = STATE.locationSubs.length;
  document.getElementById('locProgress').textContent = `${locChecked}/${locTotal}`;
  document.getElementById('locBadge').textContent = `${locChecked}/${locTotal}`;
  
  const testChecked = Object.values(STATE.testChecked).filter(v => v).length;
  const testTotal = STATE.testSubs.length;
  document.getElementById('testProgress').textContent = `${testChecked}/${testTotal}`;
  document.getElementById('testBadge').textContent = `${testChecked}/${testTotal}`;
  
  const capUsed = Object.values(STATE.captionUsed).filter(v => v).length;
  const capTotal = STATE.captions.length;
  document.getElementById('capProgress').textContent = `${capUsed}/${capTotal}`;
  document.getElementById('capBadge').textContent = `${capUsed}/${capTotal}`;
}

// ==================== IP FUNCTIONS ====================
function updateIpToggle() {
  const btn = document.getElementById('ipToggle');
  if (CONFIG.ipMode === 'local') {
    btn.textContent = 'Local';
    btn.className = 'status-toggle';
  } else {
    btn.textContent = 'Full';
    btn.className = 'status-toggle full';
  }
}

document.getElementById('ipToggle').onclick = () => {
  CONFIG.ipMode = CONFIG.ipMode === 'local' ? 'full' : 'local';
  localStorage.setItem('ipMode', CONFIG.ipMode);
  updateIpToggle();
  toast(CONFIG.ipMode === 'full' ? 'üåê Full IP' : 'üè† Local IP');
};

function triggerCatsript() {
  const input = document.getElementById('ipInput').value.trim();
  if (!input) return;
  
  let ip;
  if (CONFIG.ipMode === 'local') {
    if (isNaN(input)) return;
    ip = `192.168.1.${input}`;
  } else {
    ip = input;
  }
  
  // Call CatScript API to run the configured Python script
  const scriptName = CONFIG.scriptName || 'openReddit.py';
  const catScriptUrl = `http://${ip}:5000/api/script/${scriptName}/run`;
  
  fetch(catScriptUrl, {
    method: 'POST',
    mode: 'no-cors' // To avoid CORS issues
  }).then(() => {
    console.log(`‚úÖ CatScript triggered: ${scriptName} on ${ip}`);
  }).catch(() => {
    // Silently fail - the request was sent even if we can't read the response
    console.log(`üì° CatScript request sent: ${scriptName} on ${ip}`);
  });
}

async function fetchCurrentIp() {
  try {
    const response = await fetch('https://api.ipify.org?format=json');
    const data = await response.json();
    STATE.currentIp = data.ip;
    document.getElementById('currentIp').textContent = STATE.currentIp;
    document.getElementById('headerIp').textContent = STATE.currentIp;
    fetchIpLocation(STATE.currentIp);
  } catch {
    document.getElementById('currentIp').textContent = 'Offline';
    document.getElementById('headerIp').textContent = 'Offline';
    document.getElementById('ipLocation').textContent = '‚Äî';
  }
}

async function fetchIpLocation(ip) {
  try {
    const response = await fetch(`https://ipapi.co/${ip}/json/`);
    const data = await response.json();
    
    if (data.error) throw new Error('Failed');
    
    let location = '';
    if (data.city && data.region && data.country_name) {
      location = `${data.city}, ${data.region}, ${data.country_name}`;
    } else if (data.country_name) {
      location = data.country_name;
    }
    
    document.getElementById('ipLocation').textContent = location || 'Unknown';
  } catch {
    document.getElementById('ipLocation').textContent = 'Unknown';
  }
}

function rotateIp() {
  const url = CONFIG.rotateUrl || document.getElementById('rotateUrl').value.trim();
  
  if (!url) {
    toast('‚ö†Ô∏è Enter rotation URL in settings');
    return;
  }
  
  new Image().src = url + (url.includes('?') ? '&' : '?') + 't=' + Date.now();
  toast('üîÑ IP rotation triggered');
  
  setTimeout(fetchCurrentIp, 8000);
}

let scamWindow = null;

function checkIp() {
  if (STATE.currentIp) {
    STATE.previousIp = STATE.currentIp;
    document.getElementById('oldIp').textContent = STATE.previousIp;
  }
  
  if (!scamWindow || scamWindow.closed) {
    scamWindow = window.open('about:blank', '_blank');
  }
  
  fetchCurrentIp().then(() => {
    scamWindow.location.href = `https://scamalytics.com/ip/${STATE.currentIp}`;
    
    if (STATE.previousIp && STATE.previousIp !== STATE.currentIp) {
      toast('‚úÖ IP changed!');
    } else {
      toast('‚ö†Ô∏è IP unchanged');
    }
  });
}

// ==================== QUICK ACTIONS ====================
function randomNoRepeat(arr, usedState) {
  const unused = arr.filter(item => !usedState[item]);
  
  if (unused.length === 0) {
    Object.keys(usedState).forEach(key => delete usedState[key]);
    saveState();
    return randomNoRepeat(arr, usedState);
  }
  
  const pick = unused[Math.floor(Math.random() * unused.length)];
  navigator.clipboard.writeText(pick);
  usedState[pick] = true;
  saveState();
  triggerCatsript();
  return pick;
}

function copyDm() {
  const arr = STATE.dmTexts.length > 0 ? STATE.dmTexts : DEFAULTS.dms;
  randomNoRepeat(arr, STATE.dmUsed);
  toast('üíå DM copied');
}

function copyName() {
  const arr = STATE.names.length > 0 ? STATE.names : DEFAULTS.names;
  randomNoRepeat(arr, STATE.nameUsed);
  toast('üìõ Name copied');
}

function copyOf() {
  const arr = STATE.ofLines.length > 0 ? STATE.ofLines : DEFAULTS.of;
  randomNoRepeat(arr, STATE.ofUsed);
  toast('üîû OF copied');
}

function copyLink() {
  const link = STATE.linkUrl || DEFAULTS.link;
  navigator.clipboard.writeText(link);
  triggerCatsript();
  toast('üîó Link copied');
}

function randomSub() {
  if (STATE.randomSubs.length === 0) {
    toast('‚ö†Ô∏è No random subs');
    return;
  }
  
  const sub = STATE.randomSubs[Math.floor(Math.random() * STATE.randomSubs.length)];
  window.open(`https://www.reddit.com/r/${sub}`, '_blank');
  toast(`üé≤ r/${sub}`);
}

function postMain() {
  if (!STATE.currentLocation || STATE.locationSubs.length === 0) {
    toast('‚ö†Ô∏è Select location');
    return;
  }
  
  let sub = '';
  let startIndex = STATE.locationIndex;
  
  do {
    sub = STATE.locationSubs[STATE.locationIndex];
    if (!STATE.locationChecked[sub]) break;
    STATE.locationIndex = (STATE.locationIndex + 1) % STATE.locationSubs.length;
  } while (STATE.locationIndex !== startIndex);
  
  if (STATE.locationChecked[sub]) {
    STATE.locationChecked = {};
    STATE.locationIndex = 0;
    saveLocationData();
    saveState();
    toast('üîÑ All used - reset');
    sub = STATE.locationSubs[0];
  }
  
  STATE.locationChecked[sub] = true;
  STATE.locationIndex = (STATE.locationIndex + 1) % STATE.locationSubs.length;
  saveLocationData();
  saveState();
  
  const caption = getNextCaption();
  const encodedTitle = encodeURIComponent(caption);
  window.open(`https://www.reddit.com/r/${sub}/submit?title=${encodedTitle}`, '_blank');
  
  navigator.clipboard.writeText(sub);
  renderList('locList', STATE.locationSubs, STATE.locationChecked);
  renderList('capList', STATE.captions, STATE.captionUsed);
  updateAllStats();
  toast(`üìç r/${sub}`);
}

function postTest() {
  if (STATE.testSubs.length === 0) {
    toast('‚ö†Ô∏è No test subs');
    return;
  }
  
  let sub = '';
  let startIndex = STATE.testIndex;
  
  do {
    sub = STATE.testSubs[STATE.testIndex];
    if (!STATE.testChecked[sub]) break;
    STATE.testIndex = (STATE.testIndex + 1) % STATE.testSubs.length;
  } while (STATE.testIndex !== startIndex);
  
  if (STATE.testChecked[sub]) {
    STATE.testChecked = {};
    STATE.testIndex = 0;
    saveState();
    toast('üîÑ All used - reset');
    sub = STATE.testSubs[0];
  }
  
  STATE.testChecked[sub] = true;
  STATE.testIndex = (STATE.testIndex + 1) % STATE.testSubs.length;
  saveState();
  
  const caption = getNextCaption();
  const encodedTitle = encodeURIComponent(caption);
  window.open(`https://www.reddit.com/r/${sub}/submit?title=${encodedTitle}`, '_blank');
  
  navigator.clipboard.writeText(sub);
  renderList('testList', STATE.testSubs, STATE.testChecked);
  renderList('capList', STATE.captions, STATE.captionUsed);
  updateAllStats();
  toast(`üß™ r/${sub}`);
}

function getNextCaption() {
  const unused = STATE.captions.filter(cap => !STATE.captionUsed[cap]);
  
  if (unused.length === 0) {
    STATE.captionUsed = {};
    saveState();
    return STATE.captions[Math.floor(Math.random() * STATE.captions.length)] || 'Post';
  }
  
  const caption = unused[Math.floor(Math.random() * unused.length)];
  STATE.captionUsed[caption] = true;
  saveState();
  return caption;
}

function createAccount() {
  const id = document.getElementById('accId').value.trim();
  if (!id) {
    toast('‚ö†Ô∏è No ID');
    return;
  }
  
  navigator.clipboard.writeText(id);
  window.location.href = 'shortcuts://run-shortcut?name=CreateRed';
  toast('‚ûï CreateRed launched');
}

// ==================== UI HELPERS ====================
function toggleCard(header) {
  const card = header.parentElement;
  card.classList.toggle('open');
}

function toggleList(listId) {
  const list = document.getElementById(listId);
  list.style.display = list.style.display === 'block' ? 'none' : 'block';
}

function copy(elementId) {
  const el = document.getElementById(elementId);
  el.select();
  navigator.clipboard.writeText(el.value);
  triggerCatsript();
  toast('üìã Copied');
}

function toast(message) {
  const toastEl = document.getElementById('toast');
  toastEl.textContent = message;
  toastEl.classList.add('show');
  
  clearTimeout(toastEl.timeout);
  toastEl.timeout = setTimeout(() => {
    toastEl.classList.remove('show');
  }, 2500);
}

// ==================== EVENT LISTENERS ====================
document.getElementById('accUser').addEventListener('input', updateAccountStatus);

document.getElementById('settingsModal').addEventListener('click', (e) => {
  if (e.target.id === 'settingsModal') {
    closeSettings();
  }
});

window.addEventListener('load', init);
window.addEventListener('beforeunload', stopAccountChecker);
</script>
</body>
</html>